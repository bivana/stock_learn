select industry_name,industry_code,a.type,count(*) as num
from stock_industry a
join (select * from industries_concepts where start_date>='2010-01-01') b
on a.industry_code=b.code
group by industry_name,industry_code,a.type
order by num desc



drop table if exists temp_stock_price;
create table if not exists temp_stock_price as
select t1.*
from stock_price t1
join (select * from stock_industry where industry_code = '801021' ) t2 
on t1.code=t2.code
where  data_date between '2010-01-01' and '2019-12-31'
;




drop table if exists temp_stock_price_grp;
create table if not exists temp_stock_price_grp as
select a.code
,d.short_name
,a.yearmonth
,a.start_date
,a.end_date
,b.close_price as start_price
,c.close_price as end_price
,(c.close_price-b.close_price)/b.close_price as grow_per
from  (
select substr(data_date,1,7) as yearmonth
,t1.code
,max(data_date) as end_date
,min(data_date) as start_date
from temp_stock_price t1
    group by t1.code ,substr(data_date,1,7)
) a
left join
(
select * from temp_stock_price
) b
on a.code=b.code
and a.start_date=b.data_date
left join
(
select * from temp_stock_price
) c
on a.code=c.code
and a.end_date=c.data_date
join stk_company_info d
on a.code=d.code
;



select substr(yearmonth,6,7) as month_str
,avg(grow_per) as grow_per
,count(*) as total_num
,count(if(grow_per>0,1,null)) as grow_num
,count(if(grow_per<0,1,null)) as degree_num
,count(if(grow_per>0,1,null))/count(*) as ggr
from temp_stock_price_grp
group by substr(yearmonth,6,7)
order by ggr desc

计算机I

02	0.7865	0.11129638521421377	192	151	32
12	0.6451	0.05143646627550621	386	249	131
03	0.5876	0.09294263986293014	194	114	69
08	0.5099	0.015274351180876621	202	103	87
10	0.4908	0.020511616783128343	381	187	182
09	0.4619	0.020829013417976328	381	176	195
05	0.4545	0.05139411629552512	198	90	96
06	0.4221	-0.000924688794421091	199	84	101
07	0.4030	-0.016687258046448734	201	81	106
01	0.3632	-0.023764565521246814	190	69	110
11	0.3272	-0.013028643917266216	382	125	250
04	0.2615	-0.026519071962656873	195	51	129

沪深港通重仓
02	0.6840	0.05090603971591313	712	487	209
10	0.6074	0.025500443205406273	861	523	314
12	0.5769	0.030786308285122004	865	499	355
07	0.5265	0.017020632105374623	718	378	318
03	0.5028	0.02230272028606688	714	359	349
09	0.5000	0.013898171762968965	858	429	407
01	0.4838	0.0032995430804302795	709	343	355
05	0.4735	0.021215371231882073	716	339	361
06	0.4714	-0.011080780125683365	717	338	360
11	0.4705	0.008816829525109286	863	406	438
08	0.4612	-0.00045073234593465307	722	333	365
04	0.4314	0.0015906458669820902	714	308	391

电气设备I
02	0.6886	0.06940516042833685	228	157	62
12	0.6129	0.03152319601027504	403	247	145
03	0.5739	0.05231137884453372	230	132	89
08	0.4979	0.014224450084287639	241	120	110
05	0.4322	0.017185573740484267	236	102	128
09	0.4148	0.009471305033113364	393	163	219
06	0.4068	-0.03378542628494828	236	96	132
01	0.3761	-0.021404204397885273	226	85	133
11	0.3750	-0.001729200976290661	400	150	238
10	0.3652	0.0005994023425035754	397	145	240
07	0.3640	0.00637114575005706	239	87	141
04	0.2661	-0.03042889848348812	233	62	163

建筑装饰I
02	0.6767	0.06571846912618656	266	180	68
03	0.6089	0.05398633325303978	271	165	90
12	0.5108	0.01819562905419834	372	190	166
08	0.4629	0.016764401793628286	283	131	138
06	0.4513	0.001359501248177027	277	125	137
10	0.4484	0.0196785813184024	368	165	185
07	0.4224	-0.002030359048775065	277	117	145
09	0.3791	0.0012578549495950043	364	138	214
11	0.3641	-0.008518856836726155	368	134	219
05	0.3370	-0.001966150572678496	273	92	166
04	0.2978	-0.015513322960743314	272	81	174
01	0.2814	-0.02320935051880783	263	74	176

国防军工I
02	0.7143	0.06995751505638519	119	85	27
08	0.6446	0.027355020381230662	121	78	36
07	0.5620	0.049205710111102016	121	68	46
12	0.5429	0.021720616923405406	175	95	74
03	0.5042	0.02934410527826216	119	60	55
01	0.4622	-0.005288689266220947	119	55	58
06	0.4500	-0.02008543367631509	120	54	57
05	0.3866	0.0058542385312737475	119	46	70
09	0.3218	-0.035403119513879734	174	56	114
11	0.2931	-0.018302614211623585	174	51	118
10	0.2816	-0.009902139700540047	174	49	118
04	0.2605	-0.027786712270169493	119	31	86



银行I
10	0.7664	0.03681871620972634	214	164	45
02	0.6269	0.04199135790113236	201	126	67
01	0.5522	0.01337352816220241	201	111	88
07	0.5490	0.02167698169443944	204	112	89
04	0.4680	-0.0013842917191741278	203	95	98
12	0.4676	0.028922599022239186	216	101	114
06	0.4581	-0.01705571522815612	203	93	108
03	0.4532	0.004431553858604859	203	92	110
09	0.4178	-0.0031455115267478373	213	89	121
11	0.3704	-0.0046813437971587	216	80	134
08	0.3413	-0.01288266547527336	208	71	129
05	0.3399	-0.022844464512364545	203	69	133

10w本金模拟
14 中信银行 6,625
15 平安银行 1,184
16 南京银行 4,880
17 宁波银行 6,564 
18 宁波银行 3,500
19 宁波银行 6,233


家用电器 
02	0.7375	0.06853533958862526	160	118	39
03	0.6173	0.06319364781094677	162	100	58
12	0.5392	0.018175331787877672	204	110	90
10	0.5271	0.006129238403876896	203	107	93
05	0.5181	0.033300515753649985	166	86	74
07	0.4790	0.0008660046330836014	167	80	80
09	0.4778	0.005444817482580958	203	97	103
06	0.4277	-0.019532194595709634	166	71	90
01	0.4151	-0.0027177670352830177	159	66	89
08	0.3952	-0.017935752907930456	167	66	95
11	0.3842	-0.010610354001436301	203	78	121
04	0.3841	0.0006917794739873629	164	63	98

钢铁I
02	0.7476	0.056229820122664545	103	77	21
12	0.5000	0.017036179250596414	124	62	54
11	0.4959	-0.00281057069089812	123	61	56
01	0.4660	-0.016294417512447337	103	48	49
07	0.4660	0.03104599428435481	103	48	44
08	0.4078	0.01169875170995018	103	42	51
10	0.3821	-0.001002755350096592	123	47	68
03	0.3786	-0.0076203036495599424	103	39	58
04	0.3786	-0.003403052317395963	103	39	59
06	0.3592	-0.021427394968937835	103	37	55
05	0.3010	-0.024054947432699116	103	31	63
09	0.3008	-0.022985515433629894	123	37	79





drop table if exists stock_month_price;
create table if not exists stock_month_price as
select a.code
,d.short_name
,a.yearmonth
,a.start_date
,a.end_date
,b.close_price as start_price
,c.close_price as end_price
,(c.close_price-b.close_price)/b.close_price as grow_per
from  (
select substr(data_date,1,7) as yearmonth
,t1.code
,max(data_date) as end_date
,min(data_date) as start_date
from stock_price t1
where data_date between '2010-01-01' and '2019-12-31'
    group by t1.code ,substr(data_date,1,7)
) a
left join
(
select * from stock_price where data_date between '2010-01-01' and '2019-12-31'
) b
on a.code=b.code
and a.start_date=b.data_date
left join
(
select * from stock_price where data_date between '2010-01-01' and '2019-12-31'
) c
on a.code=c.code
and a.end_date=c.data_date
join stk_company_info d
on a.code=d.code
;